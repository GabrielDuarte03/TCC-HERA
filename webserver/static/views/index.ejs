<html lang="pt-br">
<head>
  
    <link rel="icon" type="image/png" href="./img/heraLetra.svg"/>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/main.css">
    <title>ALTERAR SENHA</title>

    <style type="text/css">
    .login100-form-btn:hover {
     background: #333333;
        }
    </style>
</head>
<body style="background-color: #ffffff;" onload="foi()">
    <div class="limiter" style="display:flex; align-items: center; justify-content: center;width: 100%; margin: 0 auto;">
        <div class="login100-form validate-form" style=" width: 560px; min-height: 100vh; display: block; background-color: #f7f7f7; padding: 173px 55px 55px 55px;">
            <div class="imagemLogin" style="  display: flex; align-items: center; justify-content: center; margin-bottom: 20%;">
                <img src="./img/hera.svg">
            </div>
            <span class="login100-form-title p-b-43" style="width: 100%; display: block; font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; font-size: 30px; color: #333333; line-height: 1.2; text-align: center;">

                REDEFINA A SUA SENHA
            </span>
            <br>
            <br>
            <br>


    <div class="wrap-input100 validate-input"  style="display: -webkit-box; display: -webkit-flex; display: -moz-box; display: -ms-flexbox; display: flex; flex-wrap: wrap; align-items: flex-end; width: 100%; height: 80px; position: relative; margin-bottom: 10px;">
    <strong><label style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; ">SENHA</label> </strong>  
    <input type="password" name="senha" id="senha" style="height: 100%; -webkit-transition: all 0.4s; -o-transition: all 0.4s; -moz-transition: all 0.4s; transition: all 0.4s;   display: block; width: 100%; background: transparent; font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; font-size: 18px; color: #555555; line-height: 1.2; padding: 0 26px; display: -webkit-box; display: -webkit-flex; display: -moz-box; display: -ms-flexbox; display: flex; flex-wrap: wrap; align-items: flex-end; width: 100%; height: 80px; position: relative; border: 1px solid #e6e6e6; border-radius: 10px; margin-bottom: 10px;">
    
    
    <br>
    <strong><label style="font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;">CONFIRMAR SENHA</label> </strong>
    <input type="password" oninput="senhasIguais()" onfocus="tamanho()" name="confirmasenha" id="confirmasenha" style="height: 100%; -webkit-transition: all 0.4s; -o-transition: all 0.4s; -moz-transition: all 0.4s; transition: all 0.4s;   display: block; width: 100%; background: transparent; font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; font-size: 18px; color: #555555; line-height: 1.2; padding: 0 26px; display: -webkit-box; display: -webkit-flex; display: -moz-box; display: -ms-flexbox; display: flex; flex-wrap: wrap; align-items: flex-end; width: 100%; height: 80px; position: relative; border: 1px solid #e6e6e6; border-radius: 10px; margin-bottom: 10px;">
   
    <p id="errado" style="display: none; font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; color: red;">AS SENHAS DEVEM SER IGUAIS PARA CADASTRAR!</p>
    
    <br>
    <br>
    <br>
    <button type="submit" class="login100-form-btn" id="trocasenha" style="display: -webkit-box;
    display: -webkit-flex;
    display: -moz-box;
    display: -ms-flexbox;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0 20px;
    width: 100%;
    height: 50px;
    border-radius: 10px;
    background: #e0195c;
  
    font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    font-size: 19px;
    color: #fff;
    line-height: 1.2;
    text-transform: uppercase;
    letter-spacing: 1px;
  
    -webkit-transition: all 0.4s;
    -o-transition: all 0.4s;
    -moz-transition: all 0.4s;
    transition: all 0.4s;
    border-color: #e0195c;
    
    " onclick="troca()">SALVAR</button>
</div>
</div>
    
   
        <script>

            var isPasswordOk = false
            function foi(){
            var query = location.search.slice(1);
            var partes = query.split('&');
            var data = {};
            partes.forEach(function (parte) {
                var chaveValor = parte.split('=');
                var chave = chaveValor[0];
                var valor = chaveValor[1];
                data[chave] = valor;
            });
            if(data.foi == 1){
                console.log(data.foi);
            }
            }
            function tamanho(){
                var senha = 0;
                var senha = document.getElementById("senha").value;
                if(senha.length < 6){
                    alert("Senha muito curta!", "A senha deve ter no mínimo 6 caracteres!");
                    document.getElementById("senha").focus();
                }
                
            }
            function senhasIguais(){
                var senha = document.getElementById('senha').value;
                var confirmasenha = document.getElementById('confirmasenha').value;
                
                if(senha == confirmasenha){

                    document.getElementById('confirmasenha').style.backgroundColor = '#C5FFC9'; //cor azul
                    document.getElementById('errado').style.display = 'none'; //tira mensagem de erro
                    document.getElementById('trocasenha').disabled = false;  //habilita o botao
                   isPasswordOk = true;
                
                }else{
                    document.getElementById('confirmasenha').style.backgroundColor = '#FF9A9A'; //troca cor
                    document.getElementById('errado').style.display = 'flex'; //mostra mensagem de erro
                    document.getElementById('trocasenha').disabled = true;  //desabilita botão
                    console.log('senhas diferentes ' + confirmasenha);
                }

            }

            function mostrasenha(){
                var senha = document.getElementById('senha');
                var olho = document.getElementById('olho');
                if(senha.type == 'password'){
                    senha.type = 'text';
                    olho.src = './img/olhofechado.svg';
                }else{
                    senha.type = 'password';
                    olho.src = './img/olhoaberto.svg';
                }
            }
            function mostrasenha2(){
                var senha = document.getElementById('confirmasenha');
                var olho = document.getElementById('olho2');
                if(senha.type == 'password'){
                    senha.type = 'text';
                    olho.src = './img/olhofechado.svg';
                }else{
                    senha.type = 'password';
                    olho.src = './img/olhoaberto.svg';
                }
            }
           
            function troca(){
            
                if(isPasswordOk){
            var query = location.search.slice(1);
            var partes = query.split('&');
            var data = {};
            partes.forEach(function (parte) {
                var chaveValor = parte.split('=');
                var chave = chaveValor[0];
                var valor = chaveValor[1];
                data[chave] = valor;
            });

            console.log(data); 
            (async ()=>{
                let rec = await fetch('http://localhost:3000/troca?mode='+data.mode+'&oobCode='+data.oobCode+'&apiKey='+data.apiKey+'&lang='+data.lang+'&newPassword='+document.getElementById('senha').value);
                window.location.href = 'http://localhost:3000/';
                let res = await rec.json();
                
              
                
            })()
        }else{
            console.log('senhas diferentes');
        }
        }
        </script>
</body>
</html>